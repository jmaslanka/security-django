{% extends "base.html" %}

{% load i18n static crispy_forms_tags %}

{% block title %}Settings{% endblock title %}


{% block content %}
  <h1>{% trans 'MFA settings' %}</h1>

  {% if message %}
    <div class="bg-success text-white">
      <p>{{ message }}<p>
      {% if codes %}
        <ul>
          {% for code in codes %}
            <li>{{ code }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  {% endif %}

  {% if user.has_mfa_enabled %}
    <p>{% trans 'Your MFA has been set on ' %} {{ user.otp.created }}.</p>
    <p>{% trans 'Enter the code generated by device to do any actions.' %}</p>
    <form method="POST">
      {% csrf_token %}
      {{ form|crispy }}
      <input class="btn btn-danger" type="submit" name="disable" value="{% trans 'Disable MFA' %}"></input>
      <input class="btn btn-warning" type="submit" name="new_codes" value="{% trans 'New recovery codes' %}"></input>
    </form>
  {% else %}
    <canvas id="qr"></canvas><br>
    <p>{% trans 'Scan this code with your application and type in the code.' %}</p>
    <form method="POST">
      {% csrf_token %}
      {{ form|crispy }}
      <input type="submit" value="{% trans 'Set MFA' %}" class="btn btn-success"></input>
    </form>
  {% endif %}

  <a href="{% url 'homepage' %}"><button class="btn btn-secondary">{% trans 'Back to homepage' %}</button></a>
  <a href="{% url 'auth:settings' %}"><button class="btn btn-secondary">{% trans 'Back to settings' %}</button></a>

{% endblock content %}

{% block scripts_body %}
  {{ block.super }}
  <script src="{% static 'auth_ex/js/qrious.min.js' %}"></script>
{% endblock scripts_body %}
